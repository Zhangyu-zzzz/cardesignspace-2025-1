#!/bin/bash

# è°ƒè¯•è¾“å…¥æ¡†æ ‡ç­¾æ·»åŠ é—®é¢˜

set -e

echo "ğŸ” è°ƒè¯•è¾“å…¥æ¡†æ ‡ç­¾æ·»åŠ é—®é¢˜..."
echo "=========================="

cd /Users/zobot/Desktop/unsplash-crawler/test/auto-gallery

# 1. æ£€æŸ¥ä¿®æ”¹çŠ¶æ€
echo "1ï¸âƒ£ æ£€æŸ¥ä¿®æ”¹çŠ¶æ€..."
if grep -q "æ·»åŠ æ ‡ç­¾å‰:" frontend/src/views/ImageGallery.vue; then
    echo "âœ… è°ƒè¯•æ—¥å¿—å·²æ·»åŠ "
else
    echo "âŒ è°ƒè¯•æ—¥å¿—æœªæ·»åŠ "
fi

if grep -q "this.\$set" frontend/src/views/ImageGallery.vue; then
    echo "âœ… Vue.setæ–¹æ³•å·²æ·»åŠ "
else
    echo "âŒ Vue.setæ–¹æ³•æœªæ·»åŠ "
fi

# 2. é‡å¯å‰ç«¯æœåŠ¡
echo "2ï¸âƒ£ é‡å¯å‰ç«¯æœåŠ¡..."
pkill -f "npm.*serve" 2>/dev/null || true
pkill -f "vue-cli-service.*serve" 2>/dev/null || true
sleep 2

cd frontend
export NODE_OPTIONS="--openssl-legacy-provider"
npm run serve &
FRONTEND_PID=$!
echo "âœ… å‰ç«¯æœåŠ¡å¯åŠ¨ä¸­ (PID: $FRONTEND_PID)"
cd ..
sleep 15

# 3. æµ‹è¯•å‰ç«¯é¡µé¢
echo "3ï¸âƒ£ æµ‹è¯•å‰ç«¯é¡µé¢..."
FRONTEND_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:8080 2>/dev/null || echo "000")
if [ "$FRONTEND_STATUS" = "200" ]; then
    echo "âœ… å‰ç«¯é¡µé¢å¯è®¿é—® (HTTP $FRONTEND_STATUS)"
else
    echo "âŒ å‰ç«¯é¡µé¢æ— æ³•è®¿é—® (HTTP $FRONTEND_STATUS)"
fi

# 4. ç”Ÿæˆè°ƒè¯•æŠ¥å‘Š
echo ""
echo "4ï¸âƒ£ ç”Ÿæˆè°ƒè¯•æŠ¥å‘Š..."
cat > ../debug-input-tag-adding-report.md << EOF
# è¾“å…¥æ¡†æ ‡ç­¾æ·»åŠ é—®é¢˜è°ƒè¯•æŠ¥å‘Š

## è°ƒè¯•æ—¶é—´
$(date)

## é—®é¢˜æè¿°
ç”¨æˆ·åé¦ˆè¾“å…¥æ¡†è¾“å…¥çš„æ ‡ç­¾ä»ç„¶ä¸èƒ½ä¿å­˜æˆåŠŸã€‚

## è°ƒè¯•æªæ–½

### 1. æ·»åŠ è¯¦ç»†è°ƒè¯•æ—¥å¿—
åœ¨\`addTag\`æ–¹æ³•ä¸­æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼š
- æ·»åŠ æ ‡ç­¾å‰çš„çŠ¶æ€
- æ·»åŠ æ ‡ç­¾åçš„çŠ¶æ€
- èµ‹å€¼åçš„æ£€æŸ¥
- å¤±è´¥æƒ…å†µçš„æ—¥å¿—

### 2. ä½¿ç”¨Vue.setæ–¹æ³•
å°†ç›´æ¥èµ‹å€¼æ”¹ä¸ºä½¿ç”¨\`this.\$set\`æ–¹æ³•ï¼š
\`\`\`javascript
// ä¿®æ”¹å‰
this.selectedImage.tags = newTags

// ä¿®æ”¹å
this.\$set(this.selectedImage, 'tags', newTags)
\`\`\`

### 3. è°ƒè¯•ä¿¡æ¯è¯´æ˜
æ§åˆ¶å°ä¼šæ˜¾ç¤ºä»¥ä¸‹ä¿¡æ¯ï¼š
- \`æ·»åŠ æ ‡ç­¾å‰:\` - æ˜¾ç¤ºå½“å‰çŠ¶æ€
- \`æ·»åŠ æ ‡ç­¾å:\` - æ˜¾ç¤ºæ–°æ•°ç»„çŠ¶æ€
- \`èµ‹å€¼åæ£€æŸ¥:\` - æ˜¾ç¤ºèµ‹å€¼åçš„çŠ¶æ€
- \`æ·»åŠ æ ‡ç­¾å¤±è´¥:\` - æ˜¾ç¤ºå¤±è´¥åŸå› 

## æµ‹è¯•æ­¥éª¤

### 1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
1. è®¿é—®å‰ç«¯é¡µé¢: http://localhost:8080
2. æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ°Consoleæ ‡ç­¾é¡µ

### 2. æµ‹è¯•è¾“å…¥æ¡†æ ‡ç­¾æ·»åŠ 
1. ç‚¹å‡»ä»»æ„å›¾ç‰‡æ‰“å¼€è¯¦æƒ…æ¨¡æ€æ¡†
2. ç‚¹å‡»"ç¼–è¾‘æ ‡ç­¾"æŒ‰é’®
3. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ–°æ ‡ç­¾ï¼ˆå¦‚"æµ‹è¯•è¾“å…¥æ ‡ç­¾"ï¼‰
4. æŒ‰å›è½¦é”®æ·»åŠ æ ‡ç­¾
5. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºçš„è°ƒè¯•ä¿¡æ¯

### 3. åˆ†æè°ƒè¯•ä¿¡æ¯
æ ¹æ®æ§åˆ¶å°è¾“å‡ºåˆ†æé—®é¢˜ï¼š
- å¦‚æœæ˜¾ç¤º"æ·»åŠ æ ‡ç­¾å¤±è´¥" - æ£€æŸ¥è¾“å…¥å’ŒselectedImageçŠ¶æ€
- å¦‚æœæ˜¾ç¤º"æ ‡ç­¾å·²å­˜åœ¨" - æ ‡ç­¾é‡å¤ï¼Œè¿™æ˜¯æ­£å¸¸çš„
- å¦‚æœæ˜¾ç¤ºæ­£å¸¸æµç¨‹ä½†UIä¸æ›´æ–° - å¯èƒ½æ˜¯Vueå“åº”å¼é—®é¢˜

## å¯èƒ½çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### 1. Vueå“åº”å¼é—®é¢˜
**é—®é¢˜**: Vue 2çš„å“åº”å¼ç³»ç»Ÿå¯èƒ½æ— æ³•æ£€æµ‹åˆ°æ•°ç»„å˜åŒ–
**è§£å†³**: ä½¿ç”¨\`this.\$set\`æ–¹æ³•å¼ºåˆ¶æ›´æ–°

### 2. æ•°æ®æ ¼å¼é—®é¢˜
**é—®é¢˜**: tagså­—æ®µå¯èƒ½ä¸æ˜¯æ•°ç»„æ ¼å¼
**è§£å†³**: æ£€æŸ¥æ•°æ®ç±»å‹å’Œæ ¼å¼

### 3. æ—¶æœºé—®é¢˜
**é—®é¢˜**: åœ¨é”™è¯¯çš„æ—¶æœºè°ƒç”¨addTagæ–¹æ³•
**è§£å†³**: æ£€æŸ¥äº‹ä»¶ç»‘å®šå’Œè°ƒç”¨æ—¶æœº

### 4. ä½œç”¨åŸŸé—®é¢˜
**é—®é¢˜**: thisæŒ‡å‘ä¸æ­£ç¡®
**è§£å†³**: æ£€æŸ¥æ–¹æ³•ç»‘å®šå’Œä½œç”¨åŸŸ

## é¢„æœŸè°ƒè¯•è¾“å‡º

### æ­£å¸¸æƒ…å†µ
\`\`\`
æ·»åŠ æ ‡ç­¾å‰: {
  newTag: "æµ‹è¯•è¾“å…¥æ ‡ç­¾",
  currentTags: ["ç°æœ‰æ ‡ç­¾1", "ç°æœ‰æ ‡ç­¾2"],
  tagsType: "object",
  tagsLength: 2
}
æ·»åŠ æ ‡ç­¾å: {
  newTags: ["ç°æœ‰æ ‡ç­¾1", "ç°æœ‰æ ‡ç­¾2", "æµ‹è¯•è¾“å…¥æ ‡ç­¾"],
  newTagsType: "object",
  newTagsLength: 3
}
èµ‹å€¼åæ£€æŸ¥: {
  selectedImageTags: ["ç°æœ‰æ ‡ç­¾1", "ç°æœ‰æ ‡ç­¾2", "æµ‹è¯•è¾“å…¥æ ‡ç­¾"],
  selectedImageTagsType: "object",
  selectedImageTagsLength: 3
}
\`\`\`

### å¼‚å¸¸æƒ…å†µ
\`\`\`
æ·»åŠ æ ‡ç­¾å¤±è´¥: {
  newTag: "",
  hasSelectedImage: true,
  newTagTrimmed: ""
}
\`\`\`

## æœåŠ¡ä¿¡æ¯
- å‰ç«¯æœåŠ¡: http://localhost:8080
- å‰ç«¯PID: $FRONTEND_PID
- åœæ­¢æœåŠ¡: kill $FRONTEND_PID

EOF

echo "âœ… è°ƒè¯•æŠ¥å‘Šå·²ç”Ÿæˆ: debug-input-tag-adding-report.md"

echo ""
echo "ğŸ” è¾“å…¥æ¡†æ ‡ç­¾æ·»åŠ é—®é¢˜è°ƒè¯•å‡†å¤‡å®Œæˆï¼"
echo "================================="
echo ""
echo "ğŸ“Š è°ƒè¯•æ€»ç»“:"
echo "  - æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—"
echo "  - ä½¿ç”¨Vue.setæ–¹æ³•ç¡®ä¿å“åº”å¼æ›´æ–°"
echo "  - æä¾›äº†å®Œæ•´çš„è°ƒè¯•æµç¨‹"
echo "  - åˆ†æäº†å¯èƒ½çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ"
echo ""
echo "ğŸ” è°ƒè¯•æ­¥éª¤:"
echo "  1. è®¿é—®å‰ç«¯é¡µé¢: http://localhost:8080"
echo "  2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)"
echo "  3. åˆ‡æ¢åˆ°Consoleæ ‡ç­¾é¡µ"
echo "  4. ç‚¹å‡»å›¾ç‰‡æ‰“å¼€è¯¦æƒ…æ¨¡æ€æ¡†"
echo "  5. ç‚¹å‡»'ç¼–è¾‘æ ‡ç­¾'æŒ‰é’®"
echo "  6. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ–°æ ‡ç­¾å¹¶æŒ‰å›è½¦"
echo "  7. æŸ¥çœ‹æ§åˆ¶å°è°ƒè¯•ä¿¡æ¯"
echo ""
echo "ğŸ“ˆ é¢„æœŸç»“æœ:"
echo "  - æ§åˆ¶å°åº”æ˜¾ç¤ºè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯"
echo "  - æ ‡ç­¾åº”è¯¥èƒ½æ­£å¸¸æ·»åŠ åˆ°UIä¸­"
echo "  - å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·æä¾›æ§åˆ¶å°è¾“å‡º"
echo ""
echo "ğŸ› ï¸ æœåŠ¡ç®¡ç†:"
echo "  å‰ç«¯PID: $FRONTEND_PID"
echo "  åœæ­¢æœåŠ¡: kill $FRONTEND_PID"
