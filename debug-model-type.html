<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½¦å‹ç±»å‹æ›´æ–°è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #e03426;
            text-align: center;
            margin-bottom: 30px;
        }
        .debug-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .debug-section h2 {
            color: #333;
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, button {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        button {
            background-color: #e03426;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background-color: #c12e21;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .step {
            margin-bottom: 20px;
            padding: 15px;
            border-left: 4px solid #e03426;
            background-color: #fff;
        }
        .step h3 {
            margin-top: 0;
            color: #e03426;
        }
        .code {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
            border: 1px solid #e9ecef;
            white-space: pre-wrap;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.online {
            background-color: #d4edda;
            color: #155724;
        }
        .status.offline {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ è½¦å‹ç±»å‹æ›´æ–°è°ƒè¯•å·¥å…·</h1>
        
        <div class="debug-section">
            <h2>1. æœåŠ¡å™¨çŠ¶æ€æ£€æŸ¥</h2>
            <button onclick="checkServers()">æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€</button>
            <div id="serverStatus"></div>
        </div>

        <div class="debug-section">
            <h2>2. è½¦å‹æ•°æ®æµ‹è¯•</h2>
            <div class="form-group">
                <label>è½¦å‹ID:</label>
                <input type="number" id="modelId" value="1375" placeholder="è¾“å…¥è½¦å‹ID">
            </div>
            <button onclick="getModelData()">è·å–è½¦å‹æ•°æ®</button>
            <div id="modelData"></div>
        </div>

        <div class="debug-section">
            <h2>3. æ›´æ–°æµ‹è¯•</h2>
            <div class="form-group">
                <label>æ–°è½¦å‹ç±»å‹:</label>
                <select id="newType">
                    <option value="">è¯·é€‰æ‹©æ–°ç±»å‹</option>
                    <option value="è½¿è½¦">è½¿è½¦</option>
                    <option value="SUV">SUV</option>
                    <option value="MPV">MPV</option>
                    <option value="WAGON">WAGON</option>
                    <option value="SHOOTINGBRAKE">SHOOTINGBRAKE</option>
                    <option value="çš®å¡">çš®å¡</option>
                    <option value="è·‘è½¦">è·‘è½¦</option>
                    <option value="Hatchback">Hatchback</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
            </div>
            <button onclick="updateModelType()">æ›´æ–°è½¦å‹ç±»å‹</button>
            <div id="updateResult"></div>
        </div>

        <div class="debug-section">
            <h2>4. å‰ç«¯é¡µé¢æµ‹è¯•</h2>
            <div class="step">
                <h3>æµ‹è¯•æ­¥éª¤:</h3>
                <ol>
                    <li>ç¡®ä¿åç«¯æœåŠ¡å™¨è¿è¡Œåœ¨ <code>http://localhost:3000</code></li>
                    <li>ç¡®ä¿å‰ç«¯æœåŠ¡å™¨è¿è¡Œåœ¨ <code>http://localhost:8080</code></li>
                    <li>è®¿é—®è½¦å‹è¯¦æƒ…é¡µé¢: <a href="http://localhost:8080/model/1375" target="_blank">http://localhost:8080/model/1375</a></li>
                    <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)</li>
                    <li>æŸ¥çœ‹ Console æ ‡ç­¾é¡µçš„æ—¥å¿—è¾“å‡º</li>
                    <li>å°è¯•æ›´æ”¹è½¦å‹ç±»å‹å¹¶è§‚å¯Ÿæ—¥å¿—</li>
                </ol>
            </div>
            <div class="code">
// é¢„æœŸçš„æ§åˆ¶å°æ—¥å¿—:
ğŸ”„ å¼€å§‹æ›´æ–°è½¦å‹ç±»å‹: {modelId: 1375, modelName: "2027 Rivian R2", oldType: "è½¿è½¦", newType: "SUV"}
ğŸ“¡ å‘é€APIè¯·æ±‚...
ğŸ“¡ APIå“åº”: {status: "success", message: "è½¦å‹åˆ†ç±»æ›´æ–°æˆåŠŸï¼è¯¥è½¦å‹å…±æœ‰ 22 å¼ å›¾ç‰‡..."}
âœ… æ›´æ–°æˆåŠŸï¼Œæ›´æ–°æœ¬åœ°æ•°æ®
ğŸ“ æœ¬åœ°æ•°æ®å·²æ›´æ–°: {oldType: "è½¿è½¦", newType: "SUV", originalType: "SUV"}
ğŸ–¼ï¸ åˆ·æ–°å›¾ç‰‡æ•°æ®...
âœ… æ›´æ–°å®Œæˆï¼Œå½“å‰è½¦å‹ç±»å‹: SUV
ğŸ æ›´æ–°æµç¨‹ç»“æŸ
            </div>
        </div>

        <div class="debug-section">
            <h2>5. å¸¸è§é—®é¢˜æ’æŸ¥</h2>
            <div class="warning">
                <p><strong>å¦‚æœæ›´æ–°ååˆ·æ–°é¡µé¢åˆå˜å›åŸå€¼ï¼Œå¯èƒ½çš„åŸå› :</strong></p>
                <ul>
                    <li>âŒ å‰ç«¯ä»£ç æ²¡æœ‰æ­£ç¡®ä¿å­˜</li>
                    <li>âŒ æµè§ˆå™¨ç¼“å­˜é—®é¢˜</li>
                    <li>âŒ å‰ç«¯æœåŠ¡å™¨æ²¡æœ‰é‡å¯</li>
                    <li>âŒ APIè°ƒç”¨å¤±è´¥ä½†æ²¡æœ‰æ˜¾ç¤ºé”™è¯¯</li>
                    <li>âŒ æ•°æ®åº“æ›´æ–°å¤±è´¥</li>
                </ul>
            </div>
            <div class="info">
                <p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p>
                <ul>
                    <li>âœ… ç¡¬åˆ·æ–°æµè§ˆå™¨ (Ctrl+F5 æˆ– Cmd+Shift+R)</li>
                    <li>âœ… æ¸…é™¤æµè§ˆå™¨ç¼“å­˜</li>
                    <li>âœ… é‡å¯å‰ç«¯æœåŠ¡å™¨</li>
                    <li>âœ… æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯</li>
                    <li>âœ… ä½¿ç”¨æ­¤è°ƒè¯•å·¥å…·éªŒè¯API</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';

        async function checkServers() {
            const statusDiv = document.getElementById('serverStatus');
            statusDiv.innerHTML = 'æ­£åœ¨æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€...';
            
            let backendStatus = 'offline';
            let frontendStatus = 'offline';
            
            try {
                const backendResponse = await fetch(`${API_BASE}/models?limit=1`);
                if (backendResponse.ok) {
                    backendStatus = 'online';
                }
            } catch (error) {
                console.log('åç«¯æœåŠ¡å™¨æ£€æŸ¥å¤±è´¥:', error);
            }
            
            try {
                const frontendResponse = await fetch('http://localhost:8080');
                if (frontendResponse.ok) {
                    frontendStatus = 'online';
                }
            } catch (error) {
                console.log('å‰ç«¯æœåŠ¡å™¨æ£€æŸ¥å¤±è´¥:', error);
            }
            
            statusDiv.innerHTML = `
                <div>
                    <span class="status ${backendStatus}">åç«¯æœåŠ¡å™¨ (3000)</span>
                    <span class="status ${frontendStatus}">å‰ç«¯æœåŠ¡å™¨ (8080)</span>
                </div>
                <div class="code">
åç«¯API: ${backendStatus === 'online' ? 'âœ… æ­£å¸¸' : 'âŒ æ— æ³•è®¿é—®'}
å‰ç«¯é¡µé¢: ${frontendStatus === 'online' ? 'âœ… æ­£å¸¸' : 'âŒ æ— æ³•è®¿é—®'}
                </div>
            `;
        }

        async function getModelData() {
            const modelId = document.getElementById('modelId').value;
            const resultDiv = document.getElementById('modelData');
            
            if (!modelId) {
                resultDiv.innerHTML = 'è¯·è¾“å…¥è½¦å‹ID';
                resultDiv.className = 'result error';
                return;
            }
            
            try {
                resultDiv.innerHTML = 'æ­£åœ¨è·å–è½¦å‹æ•°æ®...';
                resultDiv.className = 'result info';
                
                const response = await fetch(`${API_BASE}/models/${modelId}`);
                const data = await response.json();
                
                if (data.success) {
                    const model = data.data;
                    resultDiv.innerHTML = `
è½¦å‹ID: ${model.id}
è½¦å‹åç§°: ${model.name}
å½“å‰ç±»å‹: ${model.type}
å“ç‰Œ: ${model.Brand ? model.Brand.name : 'æœªçŸ¥'}
æ›´æ–°æ—¶é—´: ${new Date(model.updatedAt).toLocaleString()}
å›¾ç‰‡æ•°é‡: ${model.Images ? model.Images.length : 0}
                    `;
                    resultDiv.className = 'result success';
                } else {
                    resultDiv.innerHTML = `è·å–å¤±è´¥: ${data.message}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `ç½‘ç»œé”™è¯¯: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function updateModelType() {
            const modelId = document.getElementById('modelId').value;
            const newType = document.getElementById('newType').value;
            const resultDiv = document.getElementById('updateResult');
            
            if (!modelId || !newType) {
                resultDiv.innerHTML = 'è¯·è¾“å…¥è½¦å‹IDå¹¶é€‰æ‹©æ–°ç±»å‹';
                resultDiv.className = 'result error';
                return;
            }
            
            try {
                resultDiv.innerHTML = 'æ­£åœ¨æ›´æ–°è½¦å‹ç±»å‹...';
                resultDiv.className = 'result info';
                
                const response = await fetch(`${API_BASE}/image-tags/models/${modelId}/type`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: newType })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    resultDiv.innerHTML = `âœ… æ›´æ–°æˆåŠŸï¼
${data.message}

æ›´æ–°åæ•°æ®:
- è½¦å‹ID: ${data.data.model.id}
- è½¦å‹åç§°: ${data.data.model.name}
- æ–°ç±»å‹: ${data.data.model.type}
- å›¾ç‰‡æ•°é‡: ${data.data.imageCount}
- æ›´æ–°æ—¶é—´: ${new Date(data.data.model.updatedAt).toLocaleString()}
                    `;
                    resultDiv.className = 'result success';
                } else {
                    resultDiv.innerHTML = `âŒ æ›´æ–°å¤±è´¥: ${data.message}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
        window.onload = function() {
            checkServers();
        };
    </script>
</body>
</html>
