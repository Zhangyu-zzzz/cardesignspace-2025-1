#!/bin/bash

###############################################################################
# æ‰‹åŠ¨ä¿®å¤å®‰å…¨é…ç½®è„šæœ¬
# ç”¨äºæ’æŸ¥å’Œä¿®å¤Nginxé…ç½®é—®é¢˜
###############################################################################

SERVER="root@49.235.98.5"

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  ğŸ”§ æ‰‹åŠ¨æ£€æŸ¥å’Œä¿®å¤å®‰å…¨é…ç½®"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

cat << 'INSTRUCTIONS'
è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ‰‹åŠ¨æ£€æŸ¥å’Œä¿®å¤ï¼š

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç¬¬ä¸€æ­¥ï¼šSSHåˆ°æœåŠ¡å™¨
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ssh root@49.235.98.5
cd /root/cardesignspace-2025

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥Nginxé…ç½®æ–‡ä»¶
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# 1. æ£€æŸ¥nginx.production.confæ˜¯å¦å·²ä¸Šä¼ 
ls -la nginx.production.conf

# 2. æŸ¥çœ‹å½“å‰Nginxä½¿ç”¨çš„é…ç½®
ls -la /etc/nginx/sites-available/cardesignspace
ls -la /etc/nginx/sites-enabled/cardesignspace

# 3. æ£€æŸ¥é…ç½®å†…å®¹ï¼ˆçœ‹æ˜¯å¦åŒ…å«å®‰å…¨è§„åˆ™ï¼‰
grep "é˜»æ­¢æ•æ„Ÿæ–‡ä»¶" /etc/nginx/sites-available/cardesignspace
# å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œè¯´æ˜é…ç½®è¿˜æ˜¯æ—§çš„

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç¬¬ä¸‰æ­¥ï¼šå¤‡ä»½å¹¶æ›´æ–°Nginxé…ç½®
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# å¤‡ä»½å½“å‰é…ç½®
sudo cp /etc/nginx/sites-available/cardesignspace /root/nginx-backup-$(date +%Y%m%d-%H%M%S).conf

# å¤åˆ¶æ–°é…ç½®
sudo cp nginx.production.conf /etc/nginx/sites-available/cardesignspace

# æµ‹è¯•é…ç½®
sudo nginx -t

# å¦‚æœæµ‹è¯•é€šè¿‡ï¼Œé‡æ–°åŠ è½½Nginx
sudo systemctl reload nginx

# éªŒè¯NginxçŠ¶æ€
sudo systemctl status nginx

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç¬¬å››æ­¥ï¼šæµ‹è¯•é˜²æŠ¤è§„åˆ™
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•ï¼ˆåº”è¯¥è¿”å›403ï¼‰
curl -I http://localhost/.env
curl -I http://localhost/phpinfo

# æˆ–åœ¨æœ¬åœ°æµ‹è¯•
exit  # å…ˆé€€å‡ºSSH
curl -I https://www.cardesignspace.com/.env

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç¬¬äº”æ­¥ï¼šæ£€æŸ¥fail2ban
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# å›åˆ°æœåŠ¡å™¨
ssh root@49.235.98.5

# æ£€æŸ¥fail2bançŠ¶æ€
sudo systemctl status fail2ban

# æŸ¥çœ‹jailåˆ—è¡¨
sudo fail2ban-client status

# å¦‚æœfail2banæœªé…ç½®ï¼Œæ‰‹åŠ¨é…ç½®ï¼š
sudo cp docs/security/fail2ban-setup.conf /etc/fail2ban/jail.d/cardesignspace.conf

# åˆ›å»ºè¿‡æ»¤å™¨ï¼ˆéœ€è¦é€ä¸ªåˆ›å»ºï¼‰
sudo nano /etc/fail2ban/filter.d/cardesignspace-malicious.conf
# å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š

[Definition]
failregex = ^<HOST> .* "(GET|POST|HEAD) /(phpinfo|wp-admin|wp-login|\.env|\.git|test\.php|console|wiki|_ignition|phpmyadmin|config|setup|install|shell|backdoor|webshell).*" (403|404|500)
            ^<HOST> .* "(bot|crawler|spider|scraper|scanner|probe|wget|curl|python-requests|java|nikto|sqlmap)" .*
ignoreregex =

# ä¿å­˜åé‡å¯fail2ban
sudo systemctl restart fail2ban

# éªŒè¯
sudo fail2ban-client status

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å¸¸è§é—®é¢˜æ’æŸ¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

é—®é¢˜1: nginx -t æŠ¥é”™
è§£å†³: æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•ï¼Œç‰¹åˆ«æ³¨æ„locationå—çš„é¡ºåº

é—®é¢˜2: é…ç½®æ­£ç¡®ä½†ä¸ç”Ÿæ•ˆ
è§£å†³: éœ€è¦ reload æˆ– restart nginx
      sudo systemctl reload nginx

é—®é¢˜3: fail2banå¯åŠ¨å¤±è´¥
è§£å†³: æ£€æŸ¥è¿‡æ»¤å™¨æ–‡ä»¶æ˜¯å¦æ­£ç¡®åˆ›å»º
      sudo fail2ban-client -t

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTRUCTIONS

echo ""
echo "æ˜¯å¦ç°åœ¨å°±SSHåˆ°æœåŠ¡å™¨è¿›è¡Œæ‰‹åŠ¨æ£€æŸ¥? (éœ€è¦è¾“å…¥å¯†ç )"
echo ""
read -p "æŒ‰å›è½¦ç»§ç»­SSHåˆ°æœåŠ¡å™¨ï¼Œæˆ–Ctrl+Cå–æ¶ˆ: "

ssh $SERVER






