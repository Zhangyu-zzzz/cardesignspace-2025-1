<!--pages/home/home.wxml-->
<view class="home-container">
  <!-- è½®æ’­å›¾ -->
  <view class="carousel-section" wx:if="{{carouselItems.length > 0}}">
    <swiper 
      class="carousel-swiper" 
      indicator-dots="{{true}}"
      autoplay="{{true}}"
      interval="{{5000}}"
      duration="{{500}}"
      circular="{{true}}"
      bindchange="onSwiperChange"
    >
      <swiper-item wx:for="{{carouselItems}}" wx:key="_key">
        <view class="carousel-item" bindtap="viewModelDetail" data-id="{{item.id}}">
          <image 
            class="carousel-image" 
            src="{{item._fallbackImage || item._imageUrl || (item.Brand && item.Brand.logo) || ''}}"
            mode="aspectFill"
            lazy-load="{{true}}"
            binderror="onCarouselImageError"
            data-index="{{index}}"
          />
          <view class="carousel-overlay">
            <view class="carousel-content">
              <text class="carousel-badge">æœ€æ–°ä¸Šä¼ </text>
              <text class="carousel-title">{{item.name}}</text>
              <text class="carousel-brand">{{item.Brand ? item.Brand.name : 'æœªçŸ¥å“ç‰Œ'}}</text>
            </view>
          </view>
        </view>
      </swiper-item>
    </swiper>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ - ä¼˜å…ˆæ˜¾ç¤ºï¼Œç¡®ä¿ç”¨æˆ·èƒ½çœ‹åˆ° -->
  <view class="error-container" wx:if="{{error && !loading}}" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 9999; background-color: #ffffff;">
    <view class="error">
      <text class="error-icon">âš ï¸</text>
      <text class="error-text">{{error}}</text>
      <text class="error-hint" wx:if="{{isDomainError}}">
        é…ç½®æ­¥éª¤ï¼šç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å° -> å¼€å‘ -> å¼€å‘ç®¡ç† -> å¼€å‘è®¾ç½® -> æœåŠ¡å™¨åŸŸå
      </text>
      <button class="btn-primary mt-20" bindtap="loadData">é‡è¯•</button>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ï¼šæ²¡æœ‰é”™è¯¯ä½†ä¹Ÿæ²¡æœ‰æ•°æ® -->
  <view class="empty-container" wx:if="{{!loading && !error && carouselItems.length === 0 && latestModels.length === 0}}">
    <view class="empty">
      <text class="empty-text">æš‚æ— æ•°æ®</text>
      <text class="empty-desc">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•</text>
      <button class="btn-primary mt-20" bindtap="loadData">é‡æ–°åŠ è½½</button>
    </view>
  </view>

  <!-- æœ€æ–°è½¦å‹ -->
  <view class="section" wx:if="{{!loading && !error}}">
    <view class="section-header">
      <text class="section-title">æœ€æ–°è½¦å‹</text>
      <text class="section-more" bindtap="onSearch">æœç´¢ğŸ”</text>
    </view>
    <view class="models-grid" wx:if="{{latestModels.length > 0}}">
      <view 
        class="model-card" 
        wx:for="{{latestModels}}" 
        wx:key="_key"
        bindtap="viewModelDetail"
        data-id="{{item.id}}"
      >
        <image 
          class="model-image" 
          src="{{item._fallbackImage || item._imageUrl || (item.Brand && item.Brand.logo) || ''}}"
          mode="aspectFill"
          lazy-load="{{true}}"
          binderror="onModelImageError"
          data-index="{{index}}"
        />
        <view class="model-info">
          <text class="model-name">{{item.name}}</text>
          <text class="model-brand">{{item.Brand ? item.Brand.name : 'æœªçŸ¥å“ç‰Œ'}}</text>
        </view>
      </view>
    </view>
    <view class="empty-container" wx:else>
      <text class="empty-text">æš‚æ— è½¦å‹æ•°æ®</text>
    </view>
    
    <!-- åŠ è½½æ›´å¤šæç¤º -->
    <view class="load-more-container" wx:if="{{latestModels.length > 0}}">
      <view class="load-more" wx:if="{{loadingMore}}">
        <text class="load-more-text">åŠ è½½ä¸­...</text>
      </view>
      <view class="load-more" wx:elif="{{!hasMoreModels}}">
        <text class="load-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
      </view>
    </view>
  </view>
</view>

