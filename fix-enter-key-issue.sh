#!/bin/bash

# ä¿®å¤å›è½¦é”®é—®é¢˜

set -e

echo "ğŸ”§ ä¿®å¤å›è½¦é”®é—®é¢˜..."
echo "=================="

cd /Users/zobot/Desktop/unsplash-crawler/test/auto-gallery

# 1. æ£€æŸ¥ä¿®æ”¹çŠ¶æ€
echo "1ï¸âƒ£ æ£€æŸ¥ä¿®æ”¹çŠ¶æ€..."
if grep -q "æ£€æµ‹åˆ°å›è½¦é”®ï¼Œè°ƒç”¨addTagæ–¹æ³•" frontend/src/views/ImageGallery.vue; then
    echo "âœ… å›è½¦é”®ä¿®å¤å·²æ·»åŠ "
else
    echo "âŒ å›è½¦é”®ä¿®å¤æœªæ·»åŠ "
fi

# 2. é‡å¯å‰ç«¯æœåŠ¡
echo "2ï¸âƒ£ é‡å¯å‰ç«¯æœåŠ¡..."
pkill -f "npm.*serve" 2>/dev/null || true
pkill -f "vue-cli-service.*serve" 2>/dev/null || true
sleep 2

cd frontend
export NODE_OPTIONS="--openssl-legacy-provider"
npm run serve &
FRONTEND_PID=$!
echo "âœ… å‰ç«¯æœåŠ¡å¯åŠ¨ä¸­ (PID: $FRONTEND_PID)"
cd ..
sleep 15

# 3. æµ‹è¯•å‰ç«¯é¡µé¢
echo "3ï¸âƒ£ æµ‹è¯•å‰ç«¯é¡µé¢..."
FRONTEND_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:8080 2>/dev/null || echo "000")
if [ "$FRONTEND_STATUS" = "200" ]; then
    echo "âœ… å‰ç«¯é¡µé¢å¯è®¿é—® (HTTP $FRONTEND_STATUS)"
else
    echo "âŒ å‰ç«¯é¡µé¢æ— æ³•è®¿é—® (HTTP $FRONTEND_STATUS)"
fi

# 4. ç”Ÿæˆä¿®å¤æŠ¥å‘Š
echo ""
echo "4ï¸âƒ£ ç”Ÿæˆä¿®å¤æŠ¥å‘Š..."
cat > ../fix-enter-key-issue-report.md << EOF
# å›è½¦é”®é—®é¢˜ä¿®å¤æŠ¥å‘Š

## ä¿®å¤æ—¶é—´
$(date)

## é—®é¢˜åˆ†æ
ä»ç”¨æˆ·æä¾›çš„æ§åˆ¶å°æ—¥å¿—å‘ç°ï¼š

### 1. è¾“å…¥æ¡†äº‹ä»¶æ­£å¸¸å·¥ä½œ
- æ¯æ¬¡æŒ‰é”®éƒ½è§¦å‘äº†\`keyupTest\`æ–¹æ³•
- äº‹ä»¶ç»‘å®šæ²¡æœ‰é—®é¢˜

### 2. v-modelç»‘å®šé—®é¢˜
- è¾“å…¥"touden"æ—¶ï¼Œ\`newTag\`æ˜¾ç¤ºä¸ºç©ºå­—ç¬¦ä¸²\`''\`
- åªæœ‰æœ€åä¸€ä¸ªå­—ç¬¦æ—¶ï¼Œ\`newTag\`æ‰æ˜¾ç¤ºæ­£ç¡®å€¼
- è¯´æ˜\`v-model="newTag"\`çš„ç»‘å®šæœ‰æ—¶åºé—®é¢˜

### 3. å›è½¦äº‹ä»¶æœªè§¦å‘
- æ²¡æœ‰çœ‹åˆ°"æ·»åŠ æ ‡ç­¾å‰"æ—¥å¿—
- è¯´æ˜\`@keyup.enter\`äº‹ä»¶æ²¡æœ‰æ­£ç¡®è§¦å‘

## ä¿®å¤æ–¹æ¡ˆ

### 1. åœ¨keyupTestä¸­å¤„ç†å›è½¦äº‹ä»¶
\`\`\`javascript
keyupTest(event) {
  console.log('è¾“å…¥æ¡†æŒ‰é”®äº‹ä»¶:', {
    key: event.key,
    keyCode: event.keyCode,
    newTag: this.newTag,
    eventType: event.type,
    targetValue: event.target.value  // æ·»åŠ å®é™…è¾“å…¥å€¼
  })
  
  // å¦‚æœæ˜¯å›è½¦é”®ï¼Œç›´æ¥è°ƒç”¨addTag
  if (event.key === 'Enter' || event.keyCode === 13) {
    console.log('æ£€æµ‹åˆ°å›è½¦é”®ï¼Œè°ƒç”¨addTagæ–¹æ³•')
    this.addTag()
  }
}
\`\`\`

### 2. ç§»é™¤@keyup.enterç»‘å®š
- ç§»é™¤äº†\`@keyup.enter="addTag"\`ç»‘å®š
- ç»Ÿä¸€åœ¨\`keyupTest\`ä¸­å¤„ç†æ‰€æœ‰æŒ‰é”®äº‹ä»¶

### 3. æ·»åŠ targetValueè°ƒè¯•
- æ·»åŠ \`event.target.value\`æ¥æŸ¥çœ‹å®é™…çš„è¾“å…¥å€¼
- å¸®åŠ©è¯Šæ–­v-modelç»‘å®šé—®é¢˜

## æµ‹è¯•æ­¥éª¤

### 1. åŸºæœ¬åŠŸèƒ½æµ‹è¯•
1. è®¿é—®å‰ç«¯é¡µé¢: http://localhost:8080
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
3. åˆ‡æ¢åˆ°Consoleæ ‡ç­¾é¡µ
4. ç‚¹å‡»å›¾ç‰‡æ‰“å¼€è¯¦æƒ…æ¨¡æ€æ¡†
5. ç‚¹å‡»"ç¼–è¾‘æ ‡ç­¾"æŒ‰é’®

### 2. è¾“å…¥æ¡†æµ‹è¯•
1. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥"æµ‹è¯•æ ‡ç­¾"
2. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š
   - åº”è¯¥çœ‹åˆ°æ¯æ¬¡æŒ‰é”®çš„"è¾“å…¥æ¡†æŒ‰é”®äº‹ä»¶"
   - \`targetValue\`åº”è¯¥æ˜¾ç¤ºå®é™…è¾“å…¥çš„å†…å®¹
   - \`newTag\`å¯èƒ½æ˜¾ç¤ºä¸ºç©ºæˆ–å»¶è¿Ÿæ›´æ–°

### 3. å›è½¦é”®æµ‹è¯•
1. è¾“å…¥å®ŒæˆåæŒ‰å›è½¦é”®
2. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š
   - åº”è¯¥çœ‹åˆ°"æ£€æµ‹åˆ°å›è½¦é”®ï¼Œè°ƒç”¨addTagæ–¹æ³•"
   - åº”è¯¥çœ‹åˆ°"æ·»åŠ æ ‡ç­¾å‰"ç­‰è°ƒè¯•ä¿¡æ¯
   - æ ‡ç­¾åº”è¯¥è¢«æ·»åŠ åˆ°åˆ—è¡¨ä¸­

## é¢„æœŸç»“æœ

### æ­£å¸¸æƒ…å†µ
\`\`\`
è¾“å…¥æ¡†æŒ‰é”®äº‹ä»¶: {
  key: "æµ‹",
  keyCode: 27979,
  newTag: "",
  eventType: "keyup",
  targetValue: "æµ‹"
}
è¾“å…¥æ¡†æŒ‰é”®äº‹ä»¶: {
  key: "Enter",
  keyCode: 13,
  newTag: "æµ‹è¯•æ ‡ç­¾",
  eventType: "keyup",
  targetValue: "æµ‹è¯•æ ‡ç­¾"
}
æ£€æµ‹åˆ°å›è½¦é”®ï¼Œè°ƒç”¨addTagæ–¹æ³•
æ·»åŠ æ ‡ç­¾å‰: {
  newTag: "æµ‹è¯•æ ‡ç­¾",
  currentTags: [...],
  tagsType: "object",
  tagsLength: ...
}
\`\`\`

## æœåŠ¡ä¿¡æ¯
- å‰ç«¯æœåŠ¡: http://localhost:8080
- å‰ç«¯PID: $FRONTEND_PID
- åœæ­¢æœåŠ¡: kill $FRONTEND_PID

EOF

echo "âœ… ä¿®å¤æŠ¥å‘Šå·²ç”Ÿæˆ: fix-enter-key-issue-report.md"

echo ""
echo "ğŸ”§ å›è½¦é”®é—®é¢˜ä¿®å¤å®Œæˆï¼"
echo "====================="
echo ""
echo "ğŸ“Š ä¿®å¤æ€»ç»“:"
echo "  - åœ¨keyupTestä¸­ç›´æ¥å¤„ç†å›è½¦äº‹ä»¶"
echo "  - ç§»é™¤äº†æœ‰é—®é¢˜çš„@keyup.enterç»‘å®š"
echo "  - æ·»åŠ äº†targetValueè°ƒè¯•ä¿¡æ¯"
echo "  - ç»Ÿä¸€äº†æŒ‰é”®äº‹ä»¶å¤„ç†é€»è¾‘"
echo ""
echo "ğŸ” æµ‹è¯•æ­¥éª¤:"
echo "  1. è®¿é—®å‰ç«¯é¡µé¢: http://localhost:8080"
echo "  2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)"
echo "  3. ç‚¹å‡»å›¾ç‰‡æ‰“å¼€è¯¦æƒ…æ¨¡æ€æ¡†"
echo "  4. ç‚¹å‡»'ç¼–è¾‘æ ‡ç­¾'æŒ‰é’®"
echo "  5. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ä»»æ„æ ‡ç­¾"
echo "  6. æŒ‰å›è½¦é”®"
echo "  7. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æ˜¾ç¤º'æ£€æµ‹åˆ°å›è½¦é”®ï¼Œè°ƒç”¨addTagæ–¹æ³•'"
echo ""
echo "ğŸ“ˆ é¢„æœŸç»“æœ:"
echo "  - åº”è¯¥çœ‹åˆ°'æ£€æµ‹åˆ°å›è½¦é”®ï¼Œè°ƒç”¨addTagæ–¹æ³•'"
echo "  - åº”è¯¥çœ‹åˆ°'æ·»åŠ æ ‡ç­¾å‰'ç­‰è°ƒè¯•ä¿¡æ¯"
echo "  - æ ‡ç­¾åº”è¯¥è¢«æˆåŠŸæ·»åŠ åˆ°åˆ—è¡¨ä¸­"
echo ""
echo "ğŸ› ï¸ æœåŠ¡ç®¡ç†:"
echo "  å‰ç«¯PID: $FRONTEND_PID"
echo "  åœæ­¢æœåŠ¡: kill $FRONTEND_PID"
