# 图片标签管理功能使用指南

## 功能概述

图片标签管理功能允许管理员快速为数据库中的车型图片进行打标签和车型分类工作。该功能包括：

- 图片标签管理（添加、删除、批量操作）
- 车型分类管理（轿车、SUV、MPV、WAGON、SHOOTINGBRAKE、皮卡、跑车、其他）
- 图片筛选和搜索
- 批量操作功能
- 统计信息展示

## 数据库变更

### 新增字段

在 `images` 表中新增了 `tags` 字段：

```sql
ALTER TABLE images 
ADD COLUMN tags JSON DEFAULT ('[]') COMMENT '图片标签数组'
```

### 车型分类

`models` 表中的 `type` 字段支持以下分类：
- 轿车
- SUV
- MPV
- WAGON
- SHOOTINGBRAKE
- 皮卡
- 跑车
- Hatchback
- 其他

## 后端API

### 1. 获取图片列表
```
GET /api/image-tags/images
```

查询参数：
- `page`: 页码（默认1）
- `limit`: 每页数量（默认20）
- `modelId`: 车型ID筛选
- `hasTags`: 标签状态筛选（true/false）
- `search`: 搜索关键词

### 2. 更新图片标签
```
PUT /api/image-tags/images/:id/tags
```

请求体：
```json
{
  "tags": ["标签1", "标签2", "标签3"]
}
```

### 3. 批量更新图片标签
```
PUT /api/image-tags/images/batch-tags
```

请求体：
```json
{
  "imageIds": [1, 2, 3],
  "tags": ["标签1", "标签2"]
}
```

### 4. 更新车型分类
```
PUT /api/image-tags/models/:id/type
```

请求体：
```json
{
  "type": "SUV"
}
```

### 5. 获取统计信息
```
GET /api/image-tags/stats/tags
GET /api/image-tags/stats/model-types
```

## 前端页面

### 访问方式

1. 登录后，点击右上角用户头像
2. 在下拉菜单中选择"图片标签管理"
3. 或直接访问 `/image-tagging` 路径

### 功能说明

#### 1. 筛选功能
- **标签状态**: 筛选已标签/未标签的图片
- **车型**: 按特定车型筛选图片
- **搜索**: 按图片标题或文件名搜索

#### 2. 图片操作
- **选择图片**: 点击图片或勾选复选框
- **添加标签**: 在每张图片下方输入标签并回车
- **删除标签**: 点击标签上的 × 号
- **车型分类**: 使用下拉菜单选择车型分类

#### 3. 批量操作
- 选择多张图片后，可以使用批量标签功能
- 输入标签（用逗号分隔），点击"批量更新标签"

#### 4. 统计信息
- 显示总图片数、已标签数、未标签数
- 可查看标签使用频率统计

## 使用流程

### 1. 数据库迁移
```bash
cd backend
node scripts/add-tags-to-images.js
```

### 2. 启动服务
```bash
# 启动后端
cd backend
npm start

# 启动前端
cd frontend
npm run serve
```

### 3. 开始标签工作
1. 登录系统
2. 访问图片标签管理页面
3. 使用筛选功能找到需要处理的图片
4. 为图片添加合适的标签
5. 设置正确的车型分类
6. 使用批量操作提高效率

## 标签建议

### 常用标签类型
- **外观**: 前脸、侧面、尾部、内饰、细节
- **颜色**: 白色、黑色、红色、蓝色等
- **角度**: 正面、侧面、45度、俯视等
- **环境**: 户外、室内、夜景、雨天等
- **特殊**: 概念车、改装车、限量版等

### 标签规范
- 使用中文标签
- 标签简洁明了
- 避免重复标签
- 保持标签一致性

## 注意事项

1. **权限要求**: 需要登录用户才能访问
2. **数据备份**: 建议在大量操作前备份数据库
3. **性能考虑**: 大量图片时建议分批处理
4. **标签质量**: 确保标签准确性和一致性

## 故障排除

### 常见问题

1. **页面无法访问**
   - 检查是否已登录
   - 确认路由配置正确

2. **API调用失败**
   - 检查后端服务是否启动
   - 确认数据库连接正常

3. **标签更新失败**
   - 检查标签格式是否正确
   - 确认图片ID存在

### 日志查看
```bash
# 查看后端日志
cd backend
tail -f logs/app.log

# 查看前端控制台
# 在浏览器开发者工具中查看
```

## 扩展功能

### 未来可能的改进
- 标签自动推荐
- 图片相似度检测
- 标签统计分析
- 批量导入标签
- 标签审核功能

## 技术支持

如有问题，请联系开发团队或查看相关文档。
