#!/bin/bash

# è°ƒè¯•è¾“å…¥æ¡†äº‹ä»¶é—®é¢˜

set -e

echo "ğŸ” è°ƒè¯•è¾“å…¥æ¡†äº‹ä»¶é—®é¢˜..."
echo "====================="

cd /Users/zobot/Desktop/unsplash-crawler/test/auto-gallery

# 1. æ£€æŸ¥ä¿®æ”¹çŠ¶æ€
echo "1ï¸âƒ£ æ£€æŸ¥ä¿®æ”¹çŠ¶æ€..."
if grep -q "keyupTest" frontend/src/views/ImageGallery.vue; then
    echo "âœ… è¾“å…¥æ¡†äº‹ä»¶è°ƒè¯•å·²æ·»åŠ "
else
    echo "âŒ è¾“å…¥æ¡†äº‹ä»¶è°ƒè¯•æœªæ·»åŠ "
fi

# 2. é‡å¯å‰ç«¯æœåŠ¡
echo "2ï¸âƒ£ é‡å¯å‰ç«¯æœåŠ¡..."
pkill -f "npm.*serve" 2>/dev/null || true
pkill -f "vue-cli-service.*serve" 2>/dev/null || true
sleep 2

cd frontend
export NODE_OPTIONS="--openssl-legacy-provider"
npm run serve &
FRONTEND_PID=$!
echo "âœ… å‰ç«¯æœåŠ¡å¯åŠ¨ä¸­ (PID: $FRONTEND_PID)"
cd ..
sleep 15

# 3. æµ‹è¯•å‰ç«¯é¡µé¢
echo "3ï¸âƒ£ æµ‹è¯•å‰ç«¯é¡µé¢..."
FRONTEND_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:8080 2>/dev/null || echo "000")
if [ "$FRONTEND_STATUS" = "200" ]; then
    echo "âœ… å‰ç«¯é¡µé¢å¯è®¿é—® (HTTP $FRONTEND_STATUS)"
else
    echo "âŒ å‰ç«¯é¡µé¢æ— æ³•è®¿é—® (HTTP $FRONTEND_STATUS)"
fi

# 4. ç”Ÿæˆè°ƒè¯•æŠ¥å‘Š
echo ""
echo "4ï¸âƒ£ ç”Ÿæˆè°ƒè¯•æŠ¥å‘Š..."
cat > ../debug-input-events-report.md << EOF
# è¾“å…¥æ¡†äº‹ä»¶é—®é¢˜è°ƒè¯•æŠ¥å‘Š

## è°ƒè¯•æ—¶é—´
$(date)

## é—®é¢˜æè¿°
ç”¨æˆ·åé¦ˆè¾“å…¥æ¡†è¾“å…¥çš„æ ‡ç­¾ä¸èƒ½ä¿å­˜ï¼Œä¸”æ²¡æœ‰çœ‹åˆ°addTagæ–¹æ³•çš„è°ƒè¯•æ—¥å¿—ï¼Œè¯´æ˜è¾“å…¥æ¡†çš„å›è½¦äº‹ä»¶å¯èƒ½æ²¡æœ‰æ­£ç¡®è§¦å‘ã€‚

## è°ƒè¯•æªæ–½

### 1. æ·»åŠ è¾“å…¥æ¡†äº‹ä»¶ç›‘å¬
åœ¨è¾“å…¥æ¡†ä¸­æ·»åŠ äº†\`@keyup="keyupTest"\`äº‹ä»¶ç›‘å¬ï¼Œç”¨äºè°ƒè¯•æ‰€æœ‰æŒ‰é”®äº‹ä»¶ã€‚

### 2. æ·»åŠ keyupTestæ–¹æ³•
\`\`\`javascript
keyupTest(event) {
  console.log('è¾“å…¥æ¡†æŒ‰é”®äº‹ä»¶:', {
    key: event.key,
    keyCode: event.keyCode,
    newTag: this.newTag,
    eventType: event.type
  })
}
\`\`\`

### 3. è°ƒè¯•ä¿¡æ¯è¯´æ˜
ç°åœ¨æ§åˆ¶å°ä¼šæ˜¾ç¤ºï¼š
- \`è¾“å…¥æ¡†æŒ‰é”®äº‹ä»¶:\` - æ˜¾ç¤ºæ¯æ¬¡æŒ‰é”®çš„è¯¦ç»†ä¿¡æ¯
- \`æ·»åŠ æ ‡ç­¾å‰:\` - æ˜¾ç¤ºaddTagæ–¹æ³•è¢«è°ƒç”¨æ—¶çš„çŠ¶æ€
- \`æ·»åŠ æ ‡ç­¾å:\` - æ˜¾ç¤ºæ ‡ç­¾æ·»åŠ åçš„çŠ¶æ€

## æµ‹è¯•æ­¥éª¤

### 1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
1. è®¿é—®å‰ç«¯é¡µé¢: http://localhost:8080
2. æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ°Consoleæ ‡ç­¾é¡µ

### 2. æµ‹è¯•è¾“å…¥æ¡†äº‹ä»¶
1. ç‚¹å‡»ä»»æ„å›¾ç‰‡æ‰“å¼€è¯¦æƒ…æ¨¡æ€æ¡†
2. ç‚¹å‡»"ç¼–è¾‘æ ‡ç­¾"æŒ‰é’®
3. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ä»»æ„å­—ç¬¦ï¼ˆå¦‚"a"ï¼‰
4. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æ˜¾ç¤º"è¾“å…¥æ¡†æŒ‰é”®äº‹ä»¶"
5. æŒ‰å›è½¦é”®
6. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æ˜¾ç¤º"æ·»åŠ æ ‡ç­¾å‰"ç­‰è°ƒè¯•ä¿¡æ¯

### 3. åˆ†æè°ƒè¯•ä¿¡æ¯
æ ¹æ®æ§åˆ¶å°è¾“å‡ºåˆ†æé—®é¢˜ï¼š

#### å¦‚æœçœ‹åˆ°"è¾“å…¥æ¡†æŒ‰é”®äº‹ä»¶"
è¯´æ˜è¾“å…¥æ¡†äº‹ä»¶ç»‘å®šæ­£å¸¸ï¼Œç»§ç»­æ£€æŸ¥ï¼š
- æŒ‰å›è½¦æ—¶keyCodeåº”è¯¥æ˜¯13
- æŒ‰å›è½¦æ—¶åº”è¯¥çœ‹åˆ°"æ·»åŠ æ ‡ç­¾å‰"æ—¥å¿—

#### å¦‚æœæ²¡æœ‰çœ‹åˆ°"è¾“å…¥æ¡†æŒ‰é”®äº‹ä»¶"
è¯´æ˜è¾“å…¥æ¡†äº‹ä»¶ç»‘å®šæœ‰é—®é¢˜ï¼Œå¯èƒ½åŸå› ï¼š
- è¾“å…¥æ¡†æ²¡æœ‰è·å¾—ç„¦ç‚¹
- äº‹ä»¶ç»‘å®šå¤±è´¥
- è¾“å…¥æ¡†è¢«å…¶ä»–å…ƒç´ é®æŒ¡

## é¢„æœŸè°ƒè¯•è¾“å‡º

### æ­£å¸¸æƒ…å†µ
\`\`\`
è¾“å…¥æ¡†æŒ‰é”®äº‹ä»¶: {
  key: "a",
  keyCode: 65,
  newTag: "a",
  eventType: "keyup"
}
è¾“å…¥æ¡†æŒ‰é”®äº‹ä»¶: {
  key: "Enter",
  keyCode: 13,
  newTag: "æµ‹è¯•æ ‡ç­¾",
  eventType: "keyup"
}
æ·»åŠ æ ‡ç­¾å‰: {
  newTag: "æµ‹è¯•æ ‡ç­¾",
  currentTags: [...],
  tagsType: "object",
  tagsLength: ...
}
\`\`\`

### å¼‚å¸¸æƒ…å†µ
å¦‚æœåªçœ‹åˆ°æŒ‰é”®äº‹ä»¶ï¼Œæ²¡æœ‰çœ‹åˆ°"æ·»åŠ æ ‡ç­¾å‰"ï¼Œè¯´æ˜ï¼š
- å›è½¦äº‹ä»¶è¢«è§¦å‘äº†ï¼Œä½†addTagæ–¹æ³•æ²¡æœ‰è¢«è°ƒç”¨
- å¯èƒ½æ˜¯@keyup.enterä¿®é¥°ç¬¦çš„é—®é¢˜

## å¯èƒ½çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### 1. äº‹ä»¶ä¿®é¥°ç¬¦é—®é¢˜
**é—®é¢˜**: @keyup.enterå¯èƒ½ä¸å·¥ä½œ
**è§£å†³**: æ”¹ä¸º@keyupï¼Œåœ¨æ–¹æ³•ä¸­æ£€æŸ¥keyCode

### 2. è¾“å…¥æ¡†ç„¦ç‚¹é—®é¢˜
**é—®é¢˜**: è¾“å…¥æ¡†æ²¡æœ‰è·å¾—ç„¦ç‚¹
**è§£å†³**: ç¡®ä¿è¾“å…¥æ¡†å¯ä»¥æ­£å¸¸è·å¾—ç„¦ç‚¹

### 3. äº‹ä»¶å†’æ³¡é—®é¢˜
**é—®é¢˜**: äº‹ä»¶è¢«å…¶ä»–å…ƒç´ æ‹¦æˆª
**è§£å†³**: æ£€æŸ¥äº‹ä»¶å†’æ³¡å’Œé˜»æ­¢é»˜è®¤è¡Œä¸º

## æœåŠ¡ä¿¡æ¯
- å‰ç«¯æœåŠ¡: http://localhost:8080
- å‰ç«¯PID: $FRONTEND_PID
- åœæ­¢æœåŠ¡: kill $FRONTEND_PID

EOF

echo "âœ… è°ƒè¯•æŠ¥å‘Šå·²ç”Ÿæˆ: debug-input-events-report.md"

echo ""
echo "ğŸ” è¾“å…¥æ¡†äº‹ä»¶é—®é¢˜è°ƒè¯•å‡†å¤‡å®Œæˆï¼"
echo "============================="
echo ""
echo "ğŸ“Š è°ƒè¯•æ€»ç»“:"
echo "  - æ·»åŠ äº†è¾“å…¥æ¡†æŒ‰é”®äº‹ä»¶ç›‘å¬"
echo "  - å¯ä»¥è°ƒè¯•æ‰€æœ‰æŒ‰é”®äº‹ä»¶"
echo "  - å¯ä»¥ç¡®è®¤å›è½¦äº‹ä»¶æ˜¯å¦è¢«è§¦å‘"
echo "  - æä¾›äº†å®Œæ•´çš„è°ƒè¯•æµç¨‹"
echo ""
echo "ğŸ” è°ƒè¯•æ­¥éª¤:"
echo "  1. è®¿é—®å‰ç«¯é¡µé¢: http://localhost:8080"
echo "  2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)"
echo "  3. åˆ‡æ¢åˆ°Consoleæ ‡ç­¾é¡µ"
echo "  4. ç‚¹å‡»å›¾ç‰‡æ‰“å¼€è¯¦æƒ…æ¨¡æ€æ¡†"
echo "  5. ç‚¹å‡»'ç¼–è¾‘æ ‡ç­¾'æŒ‰é’®"
echo "  6. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ä»»æ„å­—ç¬¦"
echo "  7. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æ˜¾ç¤º'è¾“å…¥æ¡†æŒ‰é”®äº‹ä»¶'"
echo "  8. æŒ‰å›è½¦é”®ï¼ŒæŸ¥çœ‹æ˜¯å¦æ˜¾ç¤º'æ·»åŠ æ ‡ç­¾å‰'"
echo ""
echo "ğŸ“ˆ é¢„æœŸç»“æœ:"
echo "  - æ¯æ¬¡æŒ‰é”®éƒ½åº”æ˜¾ç¤º'è¾“å…¥æ¡†æŒ‰é”®äº‹ä»¶'"
echo "  - æŒ‰å›è½¦æ—¶åº”æ˜¾ç¤º'æ·»åŠ æ ‡ç­¾å‰'ç­‰è°ƒè¯•ä¿¡æ¯"
echo "  - å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·æä¾›æ§åˆ¶å°è¾“å‡º"
echo ""
echo "ğŸ› ï¸ æœåŠ¡ç®¡ç†:"
echo "  å‰ç«¯PID: $FRONTEND_PID"
echo "  åœæ­¢æœåŠ¡: kill $FRONTEND_PID"
