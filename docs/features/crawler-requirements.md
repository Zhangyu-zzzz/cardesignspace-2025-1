# 爬虫系统需求实现说明

## 📋 已实现的需求

### 1. 高清图片筛选 ✅

**要求：** 只上传至少1.2MB或高分辨率的图片（≥1200px）

**实现方式：**
- 优先获取高清图片URL：
  - `data-src-full`
  - `data-full`
  - `data-original`
  - `data-hd-src`
  - `data-high-res`
  - `srcset`（选择最高分辨率）
- 下载后检查：
  - 文件大小 ≥ 1.2MB，或
  - 宽度 ≥ 1200px 或高度 ≥ 1200px
- 不符合要求的图片会被跳过，记录到失败列表

**代码位置：**
- `backend/src/services/contentParser.js` - 提取高清图片URL
- `backend/src/services/autoUploadService.js` - 下载并验证图片质量

### 2. 车型命名格式 ✅

**要求：** 年份+品牌+车型名

**实现方式：**
- 格式：`{年份} {品牌} {车型名}`
- 示例：
  - `2024 宝马 3系`
  - `2023 奔驰 S级`
  - `2025 特斯拉 Model 3`
- 如果没有年份：`{品牌} {车型名}`
  - 示例：`宝马 3系`

**代码位置：**
- `backend/src/services/autoUploadService.js` - `uploadContent` 方法

### 3. 中文翻译 ✅

**要求：** 英文内容自动翻译成中文

**实现方式：**
- 使用 Google 翻译 API（免费，无需密钥）
- 自动检测语言（中文/英文）
- 翻译内容：
  - 文章标题
  - 文章描述
  - 图片 alt 文本
  - 图片 title 属性
- 如果检测到是中文，直接使用原文

**代码位置：**
- `backend/src/services/translationService.js` - 翻译服务
- `backend/src/services/schedulerService.js` - 在抓取时翻译
- `backend/src/services/autoUploadService.js` - 在上传时翻译

## 🔄 工作流程

1. **抓取网页** → 提取内容
2. **识别车型** → 品牌、车型、年份等
3. **翻译内容** → 英文翻译成中文
4. **筛选图片** → 只保留高清图片（≥1.5MB 或 ≥1920px）
5. **创建车型** → 使用格式：年份+品牌+车型名
6. **上传图片** → 上传高清图片和翻译后的描述

## 📊 图片筛选标准

- **文件大小：** ≥ 1.5MB
- **或分辨率：** 宽度 ≥ 1920px 或高度 ≥ 1920px
- **优先级：** 优先获取高清图片URL（data-src-full等）

## 🎯 车型命名示例

| 识别结果 | 最终车型名 |
|---------|-----------|
| 年份: 2024, 品牌: 宝马, 车型: 3系 | `2024 宝马 3系` |
| 年份: null, 品牌: 奔驰, 车型: S级 | `奔驰 S级` |
| 年份: 2025, 品牌: 特斯拉, 车型: Model 3 | `2025 特斯拉 Model 3` |

## 🌐 翻译功能

- **自动检测：** 检测文本是否为中文
- **翻译API：** Google Translate（免费）
- **翻译内容：**
  - 标题（Title）
  - 描述（Description）
  - 图片说明（Alt/Title）

## 🧪 测试

### 测试翻译功能
```bash
cd backend
node scripts/test-translation.js
```

### 查看抓取历史
```bash
# 通过API查看
GET /api/crawler/history?pageId=1
```

## ⚙️ 配置

所有功能已自动启用，无需额外配置。

## 📝 注意事项

1. **图片筛选：** 如果网页没有高清图片，可能会跳过所有图片
2. **翻译延迟：** 翻译需要时间，可能会稍微增加抓取时间
3. **网络要求：** 需要能访问 Google 翻译服务
4. **车型识别：** 如果识别置信度 < 0.5，不会自动上传

## 🔧 故障排查

### 图片都被跳过
- 检查网页是否有高清图片
- 查看日志了解具体原因
- 可以手动调整筛选标准（修改 `downloadImage` 的参数）

### 翻译失败
- 检查网络连接
- 查看日志中的错误信息
- 翻译失败时会使用原文

### 车型命名不正确
- 检查识别结果（查看抓取历史的metadata）
- 确认年份、品牌、车型是否正确识别


