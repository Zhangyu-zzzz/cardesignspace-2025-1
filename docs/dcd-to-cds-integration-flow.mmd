graph TD
  A["保持现有 API 不变"] --> B["新增第二数据源配置<br/>mysqlDell.js 读取 DELL_DB_*"]
  A --> C["新增 external_id_map 表<br/>(source, entity_type, external_id, internal_id, created_at, updated_at)<br/>唯一索引 (source, entity_type, external_id)"]
  A --> D["ETL 全量同步（一次性）"]
  D --> D1["品牌对齐与去重<br/>brands(name/logo/country)<br/>写 external_id_map"]
  D --> D2["车系落库<br/>series(name, brandId, ...)<br/>写 external_id_map"]
  D --> D3["车型聚合入模（展示级 models）<br/>type/price/specs 聚合<br/>不改现有字段/接口"]
  D --> D4["侧表保留 DELL 明细<br/>dcd_models / dcd_model_parameters / dcd_monthly_sales<br/>或新增 model_variants"]
  D3 --> D3a["specs JSON 投影<br/>price_range, year_range, energy_types,<br/>dimensions, variant_count"]
  A --> E["ETL 增量同步（定时）"]
  E --> E1["按 updated_at 窗口拉取"]
  E --> E2["幂等 UPSERT + 映射维护"]
  E --> E3["冲突处理与别名表维护"]
  A --> F["索引与性能"]
  F --> F1["增加索引<br/>brands(name), series(name, brandId), models(brandId, type)"]
  F --> F2["数据库内存优化<br/>InnoDB buffer pool ≥ 2GB"]
  A --> G["备份与容灾"]
  G --> G1["主从复制（DELL 为只读从库）"]
  G --> G2["定时逻辑备份<br/>mysqldump + 压缩 + 校验 + 保留策略"]
  A --> H["监控与校验"]
  H --> H1["每日对账：行数/哈希/抽样"]
  H --> H2["报警：失败重试/延迟阈值"]
  A --> I["风险控制"]
  I --> I1["枚举/名称归一 & 人工审核清单"]
  I --> I2["字符集/时区一致性"]
