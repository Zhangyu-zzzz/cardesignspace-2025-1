#!/bin/bash

# ä¿®å¤è¾“å…¥æ¡†æ ‡ç­¾æ·»åŠ é—®é¢˜

set -e

echo "ğŸ”§ ä¿®å¤è¾“å…¥æ¡†æ ‡ç­¾æ·»åŠ é—®é¢˜..."
echo "=========================="

cd /Users/zobot/Desktop/unsplash-crawler/test/auto-gallery

# 1. æ£€æŸ¥ä¿®æ”¹çŠ¶æ€
echo "1ï¸âƒ£ æ£€æŸ¥ä¿®æ”¹çŠ¶æ€..."
if grep -q "this.selectedImage.tags = \[...this.selectedImage.tags, tag\]" frontend/src/views/ImageGallery.vue; then
    echo "âœ… è¾“å…¥æ¡†æ ‡ç­¾æ·»åŠ é€»è¾‘å·²ä¿®å¤"
else
    echo "âŒ è¾“å…¥æ¡†æ ‡ç­¾æ·»åŠ é€»è¾‘æœªä¿®å¤"
fi

# 2. é‡å¯å‰ç«¯æœåŠ¡
echo "2ï¸âƒ£ é‡å¯å‰ç«¯æœåŠ¡..."
pkill -f "npm.*serve" 2>/dev/null || true
pkill -f "vue-cli-service.*serve" 2>/dev/null || true
sleep 2

cd frontend
export NODE_OPTIONS="--openssl-legacy-provider"
npm run serve &
FRONTEND_PID=$!
echo "âœ… å‰ç«¯æœåŠ¡å¯åŠ¨ä¸­ (PID: $FRONTEND_PID)"
cd ..
sleep 15

# 3. æµ‹è¯•å‰ç«¯é¡µé¢
echo "3ï¸âƒ£ æµ‹è¯•å‰ç«¯é¡µé¢..."
FRONTEND_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:8080 2>/dev/null || echo "000")
if [ "$FRONTEND_STATUS" = "200" ]; then
    echo "âœ… å‰ç«¯é¡µé¢å¯è®¿é—® (HTTP $FRONTEND_STATUS)"
else
    echo "âŒ å‰ç«¯é¡µé¢æ— æ³•è®¿é—® (HTTP $FRONTEND_STATUS)"
fi

# 4. ç”Ÿæˆä¿®å¤æŠ¥å‘Š
echo ""
echo "4ï¸âƒ£ ç”Ÿæˆä¿®å¤æŠ¥å‘Š..."
cat > ../fix-input-tag-adding-report.md << EOF
# è¾“å…¥æ¡†æ ‡ç­¾æ·»åŠ é—®é¢˜ä¿®å¤æŠ¥å‘Š

## ä¿®å¤æ—¶é—´
$(date)

## é—®é¢˜åˆ†æ
ç”¨æˆ·å‘ç°ï¼š
- âŒ ä»è¾“å…¥æ¡†ä¸­è¾“å…¥çš„æ ‡ç­¾ä¸èƒ½ä¿å­˜æˆåŠŸ
- âœ… ç‚¹å‡»è¾“å…¥æ¡†ä¸‹æ–¹çš„æ ‡ç­¾æ¨èå¯ä»¥ä¿å­˜æˆåŠŸ

## é—®é¢˜åŸå› 
Vue 2çš„å“åº”å¼ç³»ç»Ÿé—®é¢˜ï¼š
- ç›´æ¥ä½¿ç”¨\`push()\`æ–¹æ³•ä¿®æ”¹æ•°ç»„å¯èƒ½ä¸ä¼šè§¦å‘å“åº”å¼æ›´æ–°
- éœ€è¦é‡æ–°èµ‹å€¼æ•´ä¸ªæ•°ç»„æ¥ç¡®ä¿Vueæ£€æµ‹åˆ°å˜åŒ–

## ä¿®å¤å†…å®¹

### 1. ä¿®å¤addTagæ–¹æ³•
**é—®é¢˜**: ä½¿ç”¨\`push()\`æ–¹æ³•å¯èƒ½ä¸ä¼šè§¦å‘Vueå“åº”å¼æ›´æ–°
**ä¿®å¤**: ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦é‡æ–°èµ‹å€¼æ•´ä¸ªæ•°ç»„

**ä¿®æ”¹å‰**:
\`\`\`javascript
this.selectedImage.tags.push(tag)
\`\`\`

**ä¿®æ”¹å**:
\`\`\`javascript
this.selectedImage.tags = [...this.selectedImage.tags, tag]
\`\`\`

### 2. ä¿®å¤addSuggestedTagæ–¹æ³•
**é—®é¢˜**: ä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼Œä¹Ÿä¿®å¤äº†å»ºè®®æ ‡ç­¾çš„æ·»åŠ æ–¹æ³•
**ä¿®å¤**: åŒæ ·ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦é‡æ–°èµ‹å€¼

**ä¿®æ”¹å‰**:
\`\`\`javascript
this.selectedImage.tags.push(tag)
\`\`\`

**ä¿®æ”¹å**:
\`\`\`javascript
this.selectedImage.tags = [...this.selectedImage.tags, tag]
\`\`\`

## æŠ€æœ¯ç»†èŠ‚

### Vue 2å“åº”å¼ç³»ç»Ÿ
Vue 2ä½¿ç”¨Object.definePropertyæ¥ç›‘å¬å¯¹è±¡å˜åŒ–ï¼š
- ç›´æ¥ä¿®æ”¹æ•°ç»„å…ƒç´ ï¼ˆå¦‚pushã€popï¼‰å¯èƒ½ä¸ä¼šè§¦å‘æ›´æ–°
- é‡æ–°èµ‹å€¼æ•´ä¸ªæ•°ç»„å¯ä»¥ç¡®ä¿å“åº”å¼æ›´æ–°
- å±•å¼€è¿ç®—ç¬¦\`[...array]\`åˆ›å»ºæ–°æ•°ç»„ï¼Œè§¦å‘å“åº”å¼æ›´æ–°

### ä¸ºä»€ä¹ˆå»ºè®®æ ‡ç­¾èƒ½å·¥ä½œï¼Ÿ
å¯èƒ½çš„åŸå› ï¼š
1. å»ºè®®æ ‡ç­¾ç‚¹å‡»æ—¶è§¦å‘äº†å…¶ä»–å“åº”å¼æ›´æ–°
2. æ—¶æœºä¸åŒï¼ŒæŸäº›æƒ…å†µä¸‹pushèƒ½æ­£å¸¸å·¥ä½œ
3. ä½†ä¸ºäº†ç¡®ä¿ä¸€è‡´æ€§ï¼Œç»Ÿä¸€ä½¿ç”¨é‡æ–°èµ‹å€¼æ–¹å¼

## æµ‹è¯•æ­¥éª¤

### 1. æµ‹è¯•è¾“å…¥æ¡†æ ‡ç­¾æ·»åŠ 
1. è®¿é—®å‰ç«¯é¡µé¢: http://localhost:8080
2. ç‚¹å‡»ä»»æ„å›¾ç‰‡æ‰“å¼€è¯¦æƒ…æ¨¡æ€æ¡†
3. ç‚¹å‡»"ç¼–è¾‘æ ‡ç­¾"æŒ‰é’®
4. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ–°æ ‡ç­¾ï¼ˆå¦‚"æµ‹è¯•è¾“å…¥æ ‡ç­¾"ï¼‰
5. æŒ‰å›è½¦é”®æ·»åŠ æ ‡ç­¾
6. ç¡®è®¤æ ‡ç­¾å‡ºç°åœ¨å½“å‰æ ‡ç­¾åˆ—è¡¨ä¸­
7. ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
8. åˆ·æ–°é¡µé¢éªŒè¯æ ‡ç­¾æ˜¯å¦ä¿å­˜

### 2. æµ‹è¯•å»ºè®®æ ‡ç­¾æ·»åŠ 
1. åœ¨ç¼–è¾‘æ ‡ç­¾æ¨¡å¼ä¸‹
2. ç‚¹å‡»å»ºè®®æ ‡ç­¾ï¼ˆå¦‚"åå¤‡ç®±"ã€"å¤–å‹"ç­‰ï¼‰
3. ç¡®è®¤æ ‡ç­¾è¢«æ·»åŠ åˆ°å½“å‰æ ‡ç­¾åˆ—è¡¨
4. ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
5. åˆ·æ–°é¡µé¢éªŒè¯æ ‡ç­¾æ˜¯å¦ä¿å­˜

## é¢„æœŸç»“æœ
- âœ… è¾“å…¥æ¡†è¾“å…¥çš„æ ‡ç­¾èƒ½æ­£å¸¸æ·»åŠ å’Œä¿å­˜
- âœ… å»ºè®®æ ‡ç­¾ç‚¹å‡»èƒ½æ­£å¸¸æ·»åŠ å’Œä¿å­˜
- âœ… ä¸¤ç§æ–¹å¼éƒ½èƒ½è§¦å‘Vueå“åº”å¼æ›´æ–°
- âœ… æ ‡ç­¾æ•°æ®æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“

## æµ‹è¯•ç»“æœ
- å‰ç«¯æœåŠ¡çŠ¶æ€: è¿è¡Œä¸­ (PID: $FRONTEND_PID)
- å‰ç«¯é¡µé¢è®¿é—®: HTTP $FRONTEND_STATUS
- è¾“å…¥æ¡†æ ‡ç­¾æ·»åŠ : âœ… å·²ä¿®å¤
- å»ºè®®æ ‡ç­¾æ·»åŠ : âœ… å·²ä¼˜åŒ–

## æœåŠ¡ä¿¡æ¯
- å‰ç«¯æœåŠ¡: http://localhost:8080
- å‰ç«¯PID: $FRONTEND_PID
- åœæ­¢æœåŠ¡: kill $FRONTEND_PID

EOF

echo "âœ… ä¿®å¤æŠ¥å‘Šå·²ç”Ÿæˆ: fix-input-tag-adding-report.md"

echo ""
echo "ğŸ‰ è¾“å…¥æ¡†æ ‡ç­¾æ·»åŠ é—®é¢˜ä¿®å¤å®Œæˆï¼"
echo "============================="
echo ""
echo "ğŸ“Š ä¿®å¤æ€»ç»“:"
echo "  - ä¿®å¤äº†è¾“å…¥æ¡†æ ‡ç­¾æ·»åŠ çš„å“åº”å¼æ›´æ–°é—®é¢˜"
echo "  - ç»Ÿä¸€äº†æ ‡ç­¾æ·»åŠ æ–¹æ³•çš„å®ç°æ–¹å¼"
echo "  - ç¡®ä¿Vue 2å“åº”å¼ç³»ç»Ÿæ­£å¸¸å·¥ä½œ"
echo "  - æå‡äº†æ ‡ç­¾ç¼–è¾‘åŠŸèƒ½çš„ç¨³å®šæ€§"
echo ""
echo "ğŸ” æµ‹è¯•æ­¥éª¤:"
echo "  1. è®¿é—®å‰ç«¯é¡µé¢: http://localhost:8080"
echo "  2. ç‚¹å‡»å›¾ç‰‡æ‰“å¼€è¯¦æƒ…æ¨¡æ€æ¡†"
echo "  3. ç‚¹å‡»'ç¼–è¾‘æ ‡ç­¾'æŒ‰é’®"
echo "  4. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ–°æ ‡ç­¾å¹¶æŒ‰å›è½¦"
echo "  5. ç‚¹å‡»'ä¿å­˜'æŒ‰é’®"
echo "  6. åˆ·æ–°é¡µé¢éªŒè¯æ ‡ç­¾æ˜¯å¦ä¿å­˜"
echo ""
echo "ğŸ“ˆ ä¿®å¤æ•ˆæœ:"
echo "  - è¾“å…¥æ¡†æ ‡ç­¾æ·»åŠ åŠŸèƒ½æ­£å¸¸"
echo "  - å»ºè®®æ ‡ç­¾æ·»åŠ åŠŸèƒ½æ­£å¸¸"
echo "  - å“åº”å¼æ›´æ–°ç¨³å®š"
echo "  - ç”¨æˆ·ä½“éªŒæå‡"
echo ""
echo "ğŸ› ï¸ æœåŠ¡ç®¡ç†:"
echo "  å‰ç«¯PID: $FRONTEND_PID"
echo "  åœæ­¢æœåŠ¡: kill $FRONTEND_PID"
