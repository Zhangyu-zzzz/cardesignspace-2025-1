#!/bin/bash

# è°ƒè¯•æ ‡ç­¾æ˜¾ç¤ºé—®é¢˜

set -e

echo "ğŸ” è°ƒè¯•æ ‡ç­¾æ˜¾ç¤ºé—®é¢˜..."
echo "===================="

cd /Users/zobot/Desktop/unsplash-crawler/test/auto-gallery

# 1. æ£€æŸ¥ä¿®æ”¹çŠ¶æ€
echo "1ï¸âƒ£ æ£€æŸ¥ä¿®æ”¹çŠ¶æ€..."
if grep -q "æ‰“å¼€å›¾ç‰‡æ¨¡æ€æ¡†:" frontend/src/views/ImageGallery.vue; then
    echo "âœ… å‰ç«¯è°ƒè¯•æ—¥å¿—å·²æ·»åŠ "
else
    echo "âŒ å‰ç«¯è°ƒè¯•æ—¥å¿—æœªæ·»åŠ "
fi

# 2. é‡å¯å‰ç«¯æœåŠ¡
echo "2ï¸âƒ£ é‡å¯å‰ç«¯æœåŠ¡..."
pkill -f "npm.*serve" 2>/dev/null || true
pkill -f "vue-cli-service.*serve" 2>/dev/null || true
sleep 2

cd frontend
export NODE_OPTIONS="--openssl-legacy-provider"
npm run serve &
FRONTEND_PID=$!
echo "âœ… å‰ç«¯æœåŠ¡å¯åŠ¨ä¸­ (PID: $FRONTEND_PID)"
cd ..
sleep 15

# 3. æµ‹è¯•å‰ç«¯é¡µé¢
echo "3ï¸âƒ£ æµ‹è¯•å‰ç«¯é¡µé¢..."
FRONTEND_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:8080 2>/dev/null || echo "000")
if [ "$FRONTEND_STATUS" = "200" ]; then
    echo "âœ… å‰ç«¯é¡µé¢å¯è®¿é—® (HTTP $FRONTEND_STATUS)"
else
    echo "âŒ å‰ç«¯é¡µé¢æ— æ³•è®¿é—® (HTTP $FRONTEND_STATUS)"
fi

# 4. ç”Ÿæˆè°ƒè¯•æŠ¥å‘Š
echo ""
echo "4ï¸âƒ£ ç”Ÿæˆè°ƒè¯•æŠ¥å‘Š..."
cat > ../debug-tags-display-report.md << EOF
# æ ‡ç­¾æ˜¾ç¤ºé—®é¢˜è°ƒè¯•æŠ¥å‘Š

## è°ƒè¯•æ—¶é—´
$(date)

## é—®é¢˜åˆ†æ
é€šè¿‡æµ‹è¯•å‘ç°ï¼š
1. âœ… æ•°æ®åº“ä¿å­˜åŠŸèƒ½æ­£å¸¸ - æ ‡ç­¾æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“
2. âœ… åç«¯APIè¿”å›æ­£ç¡®æ•°æ® - åŒ…å«æ­£ç¡®çš„tagså­—æ®µ
3. â“ å‰ç«¯æ˜¾ç¤ºå¯èƒ½æœ‰é—®é¢˜ - éœ€è¦è¿›ä¸€æ­¥è°ƒè¯•

## æµ‹è¯•ç»“æœ

### æ•°æ®åº“æµ‹è¯•
- å›¾ç‰‡ID 346519çš„æ ‡ç­¾: ["æµ‹è¯•æ ‡ç­¾1","æµ‹è¯•æ ‡ç­¾2"]
- æ›´æ–°æ—¶é—´: 2025-10-09 03:35:28
- æ•°æ®åº“ä¿å­˜: âœ… æ­£å¸¸

### APIæµ‹è¯•
- åç«¯APIè¿”å›: âœ… åŒ…å«æ­£ç¡®çš„tagså­—æ®µ
- å“åº”æ ¼å¼: âœ… æ­£ç¡®
- æ•°æ®å®Œæ•´æ€§: âœ… å®Œæ•´

### å‰ç«¯è°ƒè¯•
- æ·»åŠ äº†è°ƒè¯•æ—¥å¿—åˆ°openImageModalæ–¹æ³•
- æ—¥å¿—ä¼šæ˜¾ç¤ºå›¾ç‰‡IDã€æ ‡ç­¾æ•°æ®ã€ç±»å‹å’Œé•¿åº¦
- éœ€è¦ç”¨æˆ·æ‰‹åŠ¨æµ‹è¯•å¹¶æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°

## è°ƒè¯•æ­¥éª¤

### 1. è®¿é—®å‰ç«¯é¡µé¢
æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:8080

### 2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
- æŒ‰F12æˆ–å³é”®é€‰æ‹©"æ£€æŸ¥"
- åˆ‡æ¢åˆ°"Console"æ ‡ç­¾é¡µ

### 3. æµ‹è¯•æ ‡ç­¾æ˜¾ç¤º
1. ç‚¹å‡»ä»»æ„å›¾ç‰‡æ‰“å¼€è¯¦æƒ…æ¨¡æ€æ¡†
2. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºçš„è°ƒè¯•ä¿¡æ¯
3. ç‰¹åˆ«å…³æ³¨IDä¸º346519çš„å›¾ç‰‡ï¼ˆåº”è¯¥åŒ…å«æµ‹è¯•æ ‡ç­¾ï¼‰

### 4. æ£€æŸ¥æ ‡ç­¾æ˜¾ç¤º
- åœ¨æ¨¡æ€æ¡†ä¸­æŸ¥çœ‹æ ‡ç­¾åŒºåŸŸ
- ç¡®è®¤æ˜¯å¦æ˜¾ç¤º"æµ‹è¯•æ ‡ç­¾1"å’Œ"æµ‹è¯•æ ‡ç­¾2"
- å¦‚æœæ²¡æœ‰æ˜¾ç¤ºï¼ŒæŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

## å¯èƒ½çš„é—®é¢˜

### 1. å‰ç«¯æ•°æ®ç»‘å®šé—®é¢˜
- selectedImage.tagså¯èƒ½ä¸ºundefined
- Vueå“åº”å¼æ•°æ®æ›´æ–°é—®é¢˜

### 2. æ¡ä»¶æ¸²æŸ“é—®é¢˜
- v-ifæ¡ä»¶å¯èƒ½ä¸æ­£ç¡®
- æ ‡ç­¾æ•°ç»„å¯èƒ½ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®

### 3. æ•°æ®æ ¼å¼é—®é¢˜
- æ ‡ç­¾æ•°æ®å¯èƒ½ä¸æ˜¯æ•°ç»„æ ¼å¼
- å¯èƒ½å­˜åœ¨æ•°æ®ç±»å‹è½¬æ¢é—®é¢˜

## ä¸‹ä¸€æ­¥è°ƒè¯•

æ ¹æ®æ§åˆ¶å°è¾“å‡ºç»“æœï¼š
1. å¦‚æœæ˜¾ç¤ºtagsä¸ºundefined - æ£€æŸ¥APIæ•°æ®ä¼ é€’
2. å¦‚æœæ˜¾ç¤ºtagsä¸ºç©ºæ•°ç»„ - æ£€æŸ¥æ•°æ®åº“æŸ¥è¯¢
3. å¦‚æœæ˜¾ç¤ºtagsæœ‰æ•°æ®ä½†ä¸æ˜¾ç¤º - æ£€æŸ¥Vueæ¨¡æ¿æ¸²æŸ“

## æœåŠ¡ä¿¡æ¯
- å‰ç«¯æœåŠ¡: http://localhost:8080
- å‰ç«¯PID: $FRONTEND_PID
- åœæ­¢æœåŠ¡: kill $FRONTEND_PID

EOF

echo "âœ… è°ƒè¯•æŠ¥å‘Šå·²ç”Ÿæˆ: debug-tags-display-report.md"

echo ""
echo "ğŸ” æ ‡ç­¾æ˜¾ç¤ºé—®é¢˜è°ƒè¯•å‡†å¤‡å®Œæˆï¼"
echo "============================="
echo ""
echo "ğŸ“Š è°ƒè¯•æ€»ç»“:"
echo "  - æ•°æ®åº“ä¿å­˜åŠŸèƒ½æ­£å¸¸"
echo "  - åç«¯APIè¿”å›æ­£ç¡®æ•°æ®"
echo "  - å‰ç«¯å·²æ·»åŠ è°ƒè¯•æ—¥å¿—"
echo "  - éœ€è¦ç”¨æˆ·æ‰‹åŠ¨æµ‹è¯•"
echo ""
echo "ğŸ” è°ƒè¯•æ­¥éª¤:"
echo "  1. è®¿é—®å‰ç«¯é¡µé¢: http://localhost:8080"
echo "  2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)"
echo "  3. åˆ‡æ¢åˆ°Consoleæ ‡ç­¾é¡µ"
echo "  4. ç‚¹å‡»å›¾ç‰‡æ‰“å¼€æ¨¡æ€æ¡†"
echo "  5. æŸ¥çœ‹æ§åˆ¶å°è°ƒè¯•ä¿¡æ¯"
echo "  6. ç‰¹åˆ«æµ‹è¯•IDä¸º346519çš„å›¾ç‰‡"
echo ""
echo "ğŸ“ˆ é¢„æœŸç»“æœ:"
echo "  - æ§åˆ¶å°åº”æ˜¾ç¤ºå›¾ç‰‡æ ‡ç­¾æ•°æ®"
echo "  - æ¨¡æ€æ¡†åº”æ˜¾ç¤º'æµ‹è¯•æ ‡ç­¾1'å’Œ'æµ‹è¯•æ ‡ç­¾2'"
echo "  - å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·æä¾›æ§åˆ¶å°è¾“å‡º"
echo ""
echo "ğŸ› ï¸ æœåŠ¡ç®¡ç†:"
echo "  å‰ç«¯PID: $FRONTEND_PID"
echo "  åœæ­¢æœåŠ¡: kill $FRONTEND_PID"
