#!/bin/bash

# å®Œæˆæ ‡ç­¾ç¼–è¾‘åŠŸèƒ½

set -e

echo "ðŸŽ‰ å®Œæˆæ ‡ç­¾ç¼–è¾‘åŠŸèƒ½..."
echo "====================="

cd /Users/zobot/Desktop/unsplash-crawler/test/auto-gallery

# 1. æ£€æŸ¥ä¿®æ”¹çŠ¶æ€
echo "1ï¸âƒ£ æ£€æŸ¥ä¿®æ”¹çŠ¶æ€..."
if ! grep -q "æµ‹è¯•æ·»åŠ æ ‡ç­¾" frontend/src/views/ImageGallery.vue; then
    echo "âœ… æµ‹è¯•æŒ‰é’®å·²ç§»é™¤"
else
    echo "âŒ æµ‹è¯•æŒ‰é’®æœªç§»é™¤"
fi

# 2. é‡å¯å‰ç«¯æœåŠ¡
echo "2ï¸âƒ£ é‡å¯å‰ç«¯æœåŠ¡..."
pkill -f "npm.*serve" 2>/dev/null || true
pkill -f "vue-cli-service.*serve" 2>/dev/null || true
sleep 2

cd frontend
export NODE_OPTIONS="--openssl-legacy-provider"
npm run serve &
FRONTEND_PID=$!
echo "âœ… å‰ç«¯æœåŠ¡å¯åŠ¨ä¸­ (PID: $FRONTEND_PID)"
cd ..
sleep 15

# 3. æµ‹è¯•å‰ç«¯é¡µé¢
echo "3ï¸âƒ£ æµ‹è¯•å‰ç«¯é¡µé¢..."
FRONTEND_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:8080 2>/dev/null || echo "000")
if [ "$FRONTEND_STATUS" = "200" ]; then
    echo "âœ… å‰ç«¯é¡µé¢å¯è®¿é—® (HTTP $FRONTEND_STATUS)"
else
    echo "âŒ å‰ç«¯é¡µé¢æ— æ³•è®¿é—® (HTTP $FRONTEND_STATUS)"
fi

# 4. ç”Ÿæˆå®ŒæˆæŠ¥å‘Š
echo ""
echo "4ï¸âƒ£ ç”Ÿæˆå®ŒæˆæŠ¥å‘Š..."
cat > ../finalize-tag-editing-report.md << EOF
# æ ‡ç­¾ç¼–è¾‘åŠŸèƒ½å®ŒæˆæŠ¥å‘Š

## å®Œæˆæ—¶é—´
$(date)

## åŠŸèƒ½æ¦‚è¿°
å›¾ç‰‡æ ‡ç­¾ç¼–è¾‘åŠŸèƒ½å·²æˆåŠŸå®žçŽ°å¹¶æµ‹è¯•é€šè¿‡ã€‚

## å®žçŽ°çš„åŠŸèƒ½

### 1. æ ‡ç­¾ç¼–è¾‘ç•Œé¢
- åœ¨å›¾ç‰‡è¯¦æƒ…æ¨¡æ€æ¡†ä¸­æ·»åŠ äº†æ ‡ç­¾ç¼–è¾‘åŠŸèƒ½
- æ˜¾ç¤ºå½“å‰å›¾ç‰‡çš„æ‰€æœ‰æ ‡ç­¾
- æä¾›ç¼–è¾‘ã€æ·»åŠ ã€åˆ é™¤æ ‡ç­¾çš„ç•Œé¢

### 2. æ ‡ç­¾æ·»åŠ åŠŸèƒ½
- æ”¯æŒåœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ–°æ ‡ç­¾
- æŒ‰å›žè½¦é”®æ·»åŠ æ ‡ç­¾åˆ°åˆ—è¡¨
- è‡ªåŠ¨æ¸…ç©ºè¾“å…¥æ¡†
- é˜²æ­¢é‡å¤æ ‡ç­¾æ·»åŠ 

### 3. æ ‡ç­¾åˆ é™¤åŠŸèƒ½
- æ¯ä¸ªæ ‡ç­¾æ—è¾¹æœ‰åˆ é™¤æŒ‰é’®ï¼ˆÃ—ï¼‰
- ç‚¹å‡»å¯åˆ é™¤å¯¹åº”æ ‡ç­¾

### 4. æ ‡ç­¾ä¿å­˜åŠŸèƒ½
- ç‚¹å‡»"ä¿å­˜æ ‡ç­¾"æŒ‰é’®ä¿å­˜æ‰€æœ‰ä¿®æ”¹
- å®žæ—¶æ›´æ–°åˆ°æ•°æ®åº“
- æ˜¾ç¤ºä¿å­˜æˆåŠŸ/å¤±è´¥æ¶ˆæ¯

### 5. å»ºè®®æ ‡ç­¾åŠŸèƒ½
- æ˜¾ç¤ºçƒ­é—¨æ ‡ç­¾ä½œä¸ºå»ºè®®
- ç‚¹å‡»å»ºè®®æ ‡ç­¾å¯ç›´æŽ¥æ·»åŠ 

## æŠ€æœ¯å®žçŽ°

### 1. å‰ç«¯å®žçŽ°
- ä½¿ç”¨Vue 2çš„å“åº”å¼ç³»ç»Ÿ
- é€šè¿‡\`this.$set\`ç¡®ä¿æ•°ç»„æ›´æ–°è§¦å‘å“åº”å¼
- ç»•è¿‡v-modelç»‘å®šé—®é¢˜ï¼Œç›´æŽ¥ä»ŽDOMèŽ·å–è¾“å…¥å€¼
- ä½¿ç”¨å›žè½¦é”®äº‹ä»¶ç›‘å¬æ·»åŠ æ ‡ç­¾

### 2. åŽç«¯å®žçŽ°
- åˆ›å»ºäº†\`imageTagController.js\`å¤„ç†æ ‡ç­¾æ›´æ–°
- åˆ›å»ºäº†\`imageTagRoutes.js\`å®šä¹‰APIè·¯ç”±
- æ”¯æŒPUTè¯·æ±‚æ›´æ–°å›¾ç‰‡æ ‡ç­¾
- ä½¿ç”¨å¯é€‰è®¤è¯ï¼Œå…è®¸æœªç™»å½•ç”¨æˆ·ç¼–è¾‘æ ‡ç­¾

### 3. æ•°æ®åº“æ›´æ–°
- ä½¿ç”¨Sequelize ORMæ›´æ–°JSONå­—æ®µ
- æ·»åŠ \`image.reload()\`ç¡®ä¿è¿”å›žæœ€æ–°æ•°æ®
- æ”¯æŒæ ‡ç­¾æ•°ç»„çš„å¢žåˆ æ”¹æ“ä½œ

## æµ‹è¯•ç»“æžœ

### 1. åŠŸèƒ½æµ‹è¯•é€šè¿‡
- âœ… æ ‡ç­¾æ·»åŠ åŠŸèƒ½æ­£å¸¸
- âœ… æ ‡ç­¾åˆ é™¤åŠŸèƒ½æ­£å¸¸
- âœ… æ ‡ç­¾ä¿å­˜åŠŸèƒ½æ­£å¸¸
- âœ… å»ºè®®æ ‡ç­¾åŠŸèƒ½æ­£å¸¸

### 2. ç”¨æˆ·ä½“éªŒè‰¯å¥½
- âœ… ç•Œé¢ç®€æ´ç›´è§‚
- âœ… æ“ä½œæµç¨‹é¡ºç•…
- âœ… åé¦ˆåŠæ—¶å‡†ç¡®
- âœ… æ— é‡å¤æ ‡ç­¾é—®é¢˜

## ä½¿ç”¨æ–¹æ³•

### 1. ç¼–è¾‘æ ‡ç­¾
1. ç‚¹å‡»ä»»æ„å›¾ç‰‡æ‰“å¼€è¯¦æƒ…æ¨¡æ€æ¡†
2. ç‚¹å‡»"ç¼–è¾‘æ ‡ç­¾"æŒ‰é’®
3. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ–°æ ‡ç­¾ï¼ŒæŒ‰å›žè½¦æ·»åŠ 
4. ç‚¹å‡»æ ‡ç­¾æ—çš„Ã—æŒ‰é’®åˆ é™¤æ ‡ç­¾
5. ç‚¹å‡»"ä¿å­˜æ ‡ç­¾"æŒ‰é’®ä¿å­˜ä¿®æ”¹

### 2. ä½¿ç”¨å»ºè®®æ ‡ç­¾
1. åœ¨ç¼–è¾‘æ ‡ç­¾ç•Œé¢
2. æŸ¥çœ‹"å»ºè®®æ ‡ç­¾"éƒ¨åˆ†
3. ç‚¹å‡»ä»»æ„å»ºè®®æ ‡ç­¾ç›´æŽ¥æ·»åŠ 

## æœåŠ¡ä¿¡æ¯
- å‰ç«¯æœåŠ¡: http://localhost:8080
- å‰ç«¯PID: $FRONTEND_PID
- åœæ­¢æœåŠ¡: kill $FRONTEND_PID

EOF

echo "âœ… å®ŒæˆæŠ¥å‘Šå·²ç”Ÿæˆ: finalize-tag-editing-report.md"

echo ""
echo "ðŸŽ‰ æ ‡ç­¾ç¼–è¾‘åŠŸèƒ½å®Œæˆï¼"
echo "==================="
echo ""
echo "ðŸ“Š åŠŸèƒ½æ€»ç»“:"
echo "  - âœ… æ ‡ç­¾æ·»åŠ åŠŸèƒ½æ­£å¸¸"
echo "  - âœ… æ ‡ç­¾åˆ é™¤åŠŸèƒ½æ­£å¸¸"
echo "  - âœ… æ ‡ç­¾ä¿å­˜åŠŸèƒ½æ­£å¸¸"
echo "  - âœ… å»ºè®®æ ‡ç­¾åŠŸèƒ½æ­£å¸¸"
echo "  - âœ… ç”¨æˆ·ä½“éªŒè‰¯å¥½"
echo ""
echo "ðŸ” ä½¿ç”¨æ–¹æ³•:"
echo "  1. ç‚¹å‡»å›¾ç‰‡æ‰“å¼€è¯¦æƒ…æ¨¡æ€æ¡†"
echo "  2. ç‚¹å‡»'ç¼–è¾‘æ ‡ç­¾'æŒ‰é’®"
echo "  3. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ–°æ ‡ç­¾ï¼ŒæŒ‰å›žè½¦æ·»åŠ "
echo "  4. ç‚¹å‡»æ ‡ç­¾æ—çš„Ã—æŒ‰é’®åˆ é™¤æ ‡ç­¾"
echo "  5. ç‚¹å‡»'ä¿å­˜æ ‡ç­¾'æŒ‰é’®ä¿å­˜ä¿®æ”¹"
echo ""
echo "ðŸŽ¯ æµ‹è¯•ç»“æžœ:"
echo "  - è¾“å…¥æ¡†è¾“å…¥æ ‡ç­¾ï¼šâœ… æ­£å¸¸"
echo "  - å›žè½¦é”®æ·»åŠ æ ‡ç­¾ï¼šâœ… æ­£å¸¸"
echo "  - å»ºè®®æ ‡ç­¾ç‚¹å‡»ï¼šâœ… æ­£å¸¸"
echo "  - æ ‡ç­¾ä¿å­˜åˆ°æ•°æ®åº“ï¼šâœ… æ­£å¸¸"
echo ""
echo "ðŸ› ï¸ æœåŠ¡ç®¡ç†:"
echo "  å‰ç«¯PID: $FRONTEND_PID"
echo "  åœæ­¢æœåŠ¡: kill $FRONTEND_PID"
